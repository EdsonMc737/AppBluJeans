{% extends 'template/base_modelo.html' %}
{% block template %}

<div class="perfil-header" style="background-image: url('{{ url_for('static', filename='img/capas/' ~ modelo.capa) }}');">
    <!-- Avatar -->
    <img class="perfil-avatar" src="{{ url_for('static', filename='img/destaques/' ~ modelo.imagem) }}" alt="{{ modelo.nome }}">

    <div class="perfil-info">
        <h1>{{ modelo.nome }}</h1>
        <p>{{ modelo.descricao }}</p>

        <div class="perfil-actions">
            <button>Seguir</button>
            <button>Mensagem</button>
            <button>Curtir</button>
        </div>
    </div>
</div>

<!-- Ensaios Fotográficos -->
<div class="ensaios">
    {% if modelo.ensaios %}
        {% for ensaio in modelo.ensaios %}
            <div class="ensaio">
                <h2>{{ ensaio.titulo }}</h2>
                <p>{{ ensaio.descricao }}</p>

                <div class="fotos-ensaio">
                    {% for foto in ensaio.fotos %}
                        <img src="{{ url_for('static', filename=foto) }}" alt="{{ ensaio.titulo }}">
                    {% endfor %}
                </div>
            </div>
        {% endfor %}
    {% endif %}
</div>

<!-- Modal para ampliar fotos -->
<div id="modalFoto" class="modal">
    <span class="modal-close">&times;</span>
    <span class="modal-prev">&#10094;</span>
    <span class="modal-next">&#10095;</span>
    <img class="modal-content" id="imgModal">
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    const modal = document.getElementById("modalFoto");
    const modalImg = document.getElementById("imgModal");
    const closeBtn = modal.querySelector(".modal-close");
    const prevBtn = modal.querySelector(".modal-prev");
    const nextBtn = modal.querySelector(".modal-next");

    if (!modal || !modalImg || !closeBtn || !prevBtn || !nextBtn) return;

    // Seleciona todas as fotos dentro dos ensaios
    const fotosEnsaios = document.querySelectorAll(".ensaio .fotos-ensaio img");
    if (fotosEnsaios.length === 0) return;

    let fotos = Array.from(fotosEnsaios);
    let indiceAtual = 0;

    // Abre modal ao clicar na foto
    fotos.forEach((img, idx) => {
        img.addEventListener("click", (e) => {
            e.stopPropagation();
            indiceAtual = idx;
            modalImg.src = img.src;
            modal.style.display = "flex";
        });
    });

    // Funções de navegação
    function mostrarProximo() {
        indiceAtual = (indiceAtual + 1) % fotos.length;
        modalImg.src = fotos[indiceAtual].src;
    }

    function mostrarAnterior() {
        indiceAtual = (indiceAtual - 1 + fotos.length) % fotos.length;
        modalImg.src = fotos[indiceAtual].src;
    }

    nextBtn.addEventListener("click", (e) => { e.stopPropagation(); mostrarProximo(); });
    prevBtn.addEventListener("click", (e) => { e.stopPropagation(); mostrarAnterior(); });

    // Fecha modal
    closeBtn.addEventListener("click", () => { modal.style.display = "none"; });
    modal.addEventListener("click", () => { modal.style.display = "none"; });
    modalImg.addEventListener("click", (e) => e.stopPropagation());

    // Navegação pelo teclado
    document.addEventListener("keydown", (e) => {
        if(modal.style.display === "flex") {
            if(e.key === "ArrowRight") mostrarProximo();
            if(e.key === "ArrowLeft") mostrarAnterior();
            if(e.key === "Escape") modal.style.display = "none";
        }
    });
});
</script>

{% endblock %}
