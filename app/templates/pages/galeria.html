{% extends 'template/base.html' %}
{% block template %}

<h1 class="titulo">Galeria de Modelos</h1>

<div class="gallery">
    {% for modelo in modelos %}
    <div class="card" onclick="abrirModal({{ modelo.id }})">
        <img src="{{ url_for('static', filename=modelo.thumb) }}" alt="{{ modelo.nome }}">
        
        <div class="info">
            <h2>{{ modelo.nome }}</h2>
            <p>{{ modelo.descricao }}</p>
            <span class="ver">Ver Ensaios â†’</span>
        </div>
    </div>
    {% endfor %}
</div>

<!-- Modal -->
<div id="modalEnsaio" class="modal">
    <span class="modal-close">&times;</span>
    <span class="modal-prev">&#10094;</span>
    <span class="modal-next">&#10095;</span>
    <img class="modal-content" id="imgModal">
</div>

<script>
const modelos = {{ modelos | tojson | safe }};
const modal = document.getElementById("modalEnsaio");
const modalImg = document.getElementById("imgModal");
const closeBtn = modal.querySelector(".modal-close");
const prevBtn = modal.querySelector(".modal-prev");
const nextBtn = modal.querySelector(".modal-next");

let fotos = [];
let indiceAtual = 0;

function abrirModal(idModelo) {
    const modelo = modelos.find(m => m.id === idModelo);
    fotos = modelo.ensaios.flatMap(e => e.fotos.map(f => "/static/" + f));
    indiceAtual = 0;
    modalImg.src = fotos[indiceAtual];
    modal.style.display = "flex";
}

function mostrarProximo() {
    indiceAtual = (indiceAtual + 1) % fotos.length;
    modalImg.src = fotos[indiceAtual];
}

function mostrarAnterior() {
    indiceAtual = (indiceAtual - 1 + fotos.length) % fotos.length;
    modalImg.src = fotos[indiceAtual];
}

nextBtn.addEventListener("click", e => { e.stopPropagation(); mostrarProximo(); });
prevBtn.addEventListener("click", e => { e.stopPropagation(); mostrarAnterior(); });
closeBtn.addEventListener("click", () => modal.style.display = "none");
modal.addEventListener("click", () => modal.style.display = "none");
modalImg.addEventListener("click", e => e.stopPropagation());

document.addEventListener("keydown", e => {
    if(modal.style.display === "flex") {
        if(e.key === "ArrowRight") mostrarProximo();
        if(e.key === "ArrowLeft") mostrarAnterior();
        if(e.key === "Escape") modal.style.display = "none";
    }
});
</script>

{% endblock %}
